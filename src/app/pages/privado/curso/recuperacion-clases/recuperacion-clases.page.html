<ion-header class="tab-content">
  <ion-toolbar>
    <ion-title>Recuperación de Clases</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="recargar($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="loaderInacap" *ngIf="mostrarCargando">
    <ion-spinner name="lines" color="info"></ion-spinner>
  </div>

  <ng-container *ngIf="mostrarData && recuperaciones">

    <ion-card class="tabla">
      <ion-card-header>
        <ion-row>
          <ion-col></ion-col>
          <ion-col class="text-right">
            <ion-button color="info" shape="round" (click)="solicitar()" [disabled]="!recuperacion">
              Solicitar Recuperación
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-card-header>
      <ion-card-content>
        <section class="tabla">
          <ion-radio-group [(ngModel)]="recuperacion">
            <table>
              <thead>
                <tr>
                  <th></th>
                  <th>Fecha Clase Pendiente</th>
                  <th>Libro</th>
                  <th>Bloques</th>
                  <th>Horario</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of recuperaciones" (click)="recuperacion = item" [class.selected]="recuperacion && recuperacion.lclaNcorr == item.lclaNcorr">
                  <td>
                    <ion-radio mode="md" color="info" [value]="item"></ion-radio>
                  </td>
                  <td>{{item.lclaFclase}}</td>
                  <td>{{item.lclaNcorr}}</td>
                  <td>{{item.bloques}}</td>
                  <td>
                    {{item.horaInicio}} {{item.horaHinicio}},<br />
                    {{item.horaFin}} {{item.horaHtermino}}
                  </td>
                </tr>
                <tr *ngIf="recuperaciones && recuperaciones.length == 0">
                  <td colspan="6" class="ion-text-center">Sin clases por recuperar en este momento.</td>
                </tr>
              </tbody>
            </table>
          </ion-radio-group>
        </section>
      </ion-card-content>
    </ion-card>

    <ion-card class="tabla solicitudes">
      <ion-card-header>
        <ion-card-title>Solicitudes</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <section class="tabla">
          <table>
            <thead>
              <tr>
                <th>Fecha Clase</th>
                <th>Libro</th>
                <th>Bloques</th>
                <th>Nº Clase</th>
                <th>Fecha Solicitud</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of solicitudes">
                <td>{{ item.lclaFclase }}</td>
                <td>{{ item.lclaNcorr }}</td>
                <td>{{ item.lclaNbloques }}</td>
                <td>{{ item.lclaNclaseActual }}</td>
                <td>{{ item.reclFsolicitud }}</td>
                <td>
                  <ion-icon [color]="resolverEstado(item.erecTdesc, 1)" src="assets/icon/{{resolverEstado(item.erecTdesc, 2)}}.svg"></ion-icon>
                </td>
                <td>
                  <ion-button color="medium" fill="clear" size="small" (click)="detalle($event, item)">
                    <ion-icon style="margin-right: 5px;" src="assets/icon/visibility.svg"></ion-icon>
                    <span>Ver</span>
                  </ion-button>
                </td>
              </tr>
              <tr *ngIf="solicitudes && solicitudes.length == 0">
                <td colspan="7" class="ion-text-center">Sin solicitudes en este momento</td>
              </tr>
            </tbody>
          </table>
        </section>
      </ion-card-content>
    </ion-card>

    <ion-popover class="detalle-solicitud" #popover [isOpen]="isOpen" (didDismiss)="isOpen = false" size="auto">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Estado Solicitud</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="isOpen = false">
                <ion-label>Cerrar</ion-label>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content>
          <ion-list *ngIf="solicitud" lines="none">
            <ion-item>
              <ion-label>Estado:</ion-label>
              <ion-label class="valor">{{solicitud.descripcion}}</ion-label>
            </ion-item>
            <ion-item>
              <ion-label>Fecha Solicitada:</ion-label>
              <ion-label class="valor">{{solicitud.fecha}}</ion-label>
            </ion-item>
            <ion-item>
              <ion-label>Sala:</ion-label>
              <ion-label class="valor">{{solicitud.sala}}</ion-label>
            </ion-item>
            <ion-item>
              <ion-label>Bloques</ion-label>
              <ion-label class="valor">{{solicitud.bloques}}</ion-label>
            </ion-item>
            <ion-item>
              <ion-label>Horario:</ion-label>
              <ion-label class="valor">
                {{solicitud.horaInicio}} - {{solicitud.horaHinicio}}<br />
                {{solicitud.horaFin}} - {{solicitud.horaHtermino}}
              </ion-label>
            </ion-item>
            <ion-item *ngIf="solicitud.equipamiento">
              <ion-label>Observaciones:</ion-label>
              <ion-label class="valor">{{solicitud.equipamiento}}</ion-label>
            </ion-item>
            <ion-item>
              <ion-label>Código Sección:</ion-label>
              <ion-label class="valor">{{solicitud.asigTdesc}}</ion-label>
            </ion-item>
            <ion-item>
              <ion-label>Fecha suspendida:</ion-label>
              <ion-label class="valor">{{solicitud.claseSuspendida}}</ion-label>
            </ion-item>
          </ion-list>
        </ion-content>
      </ng-template>
    </ion-popover>

  </ng-container>

  <div class="empty-state" *ngIf="mostrarData && !recuperaciones">
    <div>
      <ion-icon src="assets/icon/info.svg"></ion-icon>
      <p>Sin registros en estos momentos.</p>
    </div>
  </div>

</ion-content>